name: Documentation with Docker

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  documentation:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Generate documentation with Docker
      run: |
        docker run --rm -v $(pwd):/data \
          phpdoc/phpdoc:3 \
          run \
          -d /data/class \
          -d /data/admin \
          -t /data/docs-api \
          --template="clean" \
          --title="SimpleBlogCMS API Documentation" \
          --defaultpackagename="SimpleBlogCMS"

    - name: Create index page
      run: |
        cat > docs-api/index.html << 'EOL'
<!DOCTYPE html>
<html>
<head>
    <title>simpleBlogCMS Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin-bottom: 30px; }
        .btn { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>simpleBlogCMS Documentation</h1>
        <div class="section">
            <h2>API Documentation</h2>
            <a href="./index.html" class="btn">View PHP Documentation</a>
        </div>
    </div>
</body>
</html>
EOL

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs-api
        keep_files: true
